import{a as te,b as ae,_ as se}from"./index-b2730f11.js";import{u as le}from"./el-empty-211949be.js";/* empty css                    *//* empty css                   *//* empty css                 */import{l as oe,r as F,c as M,j as re,J as ne,q as p,t as o,H as t,B as s,A as T,E as y,ag as ie,al as ue,m as u,u as k,F as n,G as A}from"./vendor-05288756.js";import{V as _,a9 as G,P as ce,_ as de,W as _e,O as r,Y as P,a0 as ve,av as fe,aw as me,Z as pe,X as ge,ai as ye,au as ke,aA as Ee,aM as Te,aN as Ne,a5 as De,aG as Me,ao as xe,aL as we,aH as Ce}from"./element-plus-53375c2c.js";const Pe={class:"task-detail-container"},Ie={class:"back-header"},he={key:0,class:"task-content"},be={class:"card-header"},Re={key:0,class:"error-message"},Se={key:1,class:"progress-section"},Be={class:"metric-card"},Le={class:"metric-value"},Fe={class:"metric-card"},Ae={class:"metric-value"},Ge={class:"metric-card"},Oe={class:"metric-value"},Ve={class:"metric-card"},$e={class:"metric-value"},Ue={class:"metric-card"},Ye={class:"metric-value"},He={class:"metric-card"},Ke={class:"metric-value"},je={class:"metric-card success-rate"},ze={class:"metric-value"},qe={class:"action-section"},Je={key:1,class:"loading-container"},We=oe({__name:"TaskDetail",setup(Xe){const O=ie(),I=ue(),f=te(),h=le(),b=ae(),x=F(!0),N=F(null),R=M(()=>parseInt(O.params.id)),e=M(()=>f.currentTask||f.getTaskById(R.value)),v=M(()=>!e.value||e.value.status!=="COMPLETED"?null:h.getTaskMetrics(e.value.id)),V=M(()=>{if(!e.value)return 0;const l=f.getTaskStatus(e.value.id);return(l==null?void 0:l.progress)||0}),w=l=>l?P(l).format("YYYY-MM-DD HH:mm:ss"):"N/A",g=l=>l==null?"N/A":`${l.toFixed(4)} ms`,$=l=>l==null?"N/A":`${l.toFixed(2)}%`,U=l=>({PENDING:"info",RUNNING:"warning",COMPLETED:"success",FAILED:"danger"})[l]||"info",Y=l=>({PENDING:"待运行",RUNNING:"运行中",COMPLETED:"已完成",FAILED:"失败"})[l]||l,H=()=>{var c,E;if(!((c=e.value)!=null&&c.started_at)||!((E=e.value)!=null&&E.finished_at))return"N/A";const l=P(e.value.started_at),i=P(e.value.finished_at).diff(l,"second");if(i<60)return`${i} 秒`;if(i<3600)return`${Math.floor(i/60)} 分 ${i%60} 秒`;const m=Math.floor(i/3600),D=Math.floor(i%3600/60);return`${m} 小时 ${D} 分`},K=()=>{I.back()},C=async()=>{var l;try{x.value=!0,await f.fetchTask(R.value),((l=e.value)==null?void 0:l.status)==="COMPLETED"&&await h.fetchTaskPerformanceMetrics(e.value.id)}catch{_.error("加载任务详情失败")}finally{x.value=!1}},j=()=>{var l;((l=e.value)==null?void 0:l.status)==="RUNNING"&&(N.value=setInterval(async()=>{try{await f.fetchTaskStatus(e.value.id),(e.value.status==="COMPLETED"||e.value.status==="FAILED")&&(S(),await C())}catch(a){console.error("轮询任务状态失败:",a)}},2e3))},S=()=>{N.value&&(clearInterval(N.value),N.value=null)},z=async()=>{if(e.value)try{await G.confirm(`确定要停止任务 "${e.value.task_name}" 吗？`,"确认停止",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await f.stopTask(e.value.id),_.success("任务已停止"),await C()}catch(l){l!=="cancel"&&_.error("停止任务失败")}},q=async()=>{if(e.value)try{await b.generateReport(e.value.id,"pdf"),_.success("PDF报告生成成功")}catch{_.error("PDF报告生成失败")}},J=async()=>{if(e.value)try{await b.generateReport(e.value.id,"csv"),_.success("CSV报告生成成功")}catch{_.error("CSV报告生成失败")}},W=async()=>{if(e.value)try{await G.confirm(`确定要删除任务 "${e.value.task_name}" 吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await f.deleteTask(e.value.id),_.success("删除成功"),I.push("/testing")}catch(l){l!=="cancel"&&_.error("删除失败")}};return re(async()=>{await C(),j()}),ne(()=>{S()}),(l,a)=>{const i=ce,m=de,D=ve,c=fe,E=me,d=pe,B=ge,X=ye,Z=ke,Q=Ee,L=_e,ee=Ce;return u(),p("div",Pe,[o("div",Ie,[t(m,{onClick:K},{default:s(()=>[t(i,null,{default:s(()=>[t(k(Te))]),_:1}),a[0]||(a[0]=n(" 返回 ",-1))]),_:1})]),e.value?(u(),p("div",he,[t(L,{class:"task-info-card"},{header:s(()=>[o("div",be,[a[1]||(a[1]=o("span",null,"任务详情",-1)),t(D,{type:U(e.value.status),size:"large"},{default:s(()=>[n(r(Y(e.value.status)),1)]),_:1},8,["type"])])]),default:s(()=>[t(B,{gutter:24},{default:s(()=>[t(d,{span:12},{default:s(()=>[t(E,{column:1,border:""},{default:s(()=>[t(c,{label:"任务名称"},{default:s(()=>[n(r(e.value.task_name),1)]),_:1}),t(c,{label:"算法名称"},{default:s(()=>[t(D,{type:e.value.algorithm.category==="KEM"?"primary":"success"},{default:s(()=>[n(r(e.value.algorithm.name),1)]),_:1},8,["type"])]),_:1}),t(c,{label:"算法类别"},{default:s(()=>[n(r(e.value.algorithm.category==="KEM"?"KEM (密钥封装)":"数字签名"),1)]),_:1}),t(c,{label:"测试次数"},{default:s(()=>[n(r(e.value.test_count),1)]),_:1})]),_:1})]),_:1}),t(d,{span:12},{default:s(()=>[t(E,{column:1,border:""},{default:s(()=>[t(c,{label:"创建时间"},{default:s(()=>[n(r(w(e.value.created_at)),1)]),_:1}),t(c,{label:"开始时间"},{default:s(()=>[n(r(w(e.value.started_at)),1)]),_:1}),t(c,{label:"完成时间"},{default:s(()=>[n(r(w(e.value.finished_at)),1)]),_:1}),t(c,{label:"执行时长"},{default:s(()=>[n(r(H()),1)]),_:1})]),_:1})]),_:1})]),_:1}),e.value.error_message?(u(),p("div",Re,[t(X,{title:"执行错误",type:"error",description:e.value.error_message,"show-icon":"",closable:!1},null,8,["description"])])):y("",!0),e.value.status==="RUNNING"?(u(),p("div",Se,[t(Z,null,{default:s(()=>[...a[2]||(a[2]=[n("执行进度",-1)])]),_:1}),t(Q,{percentage:V.value,"stroke-width":20,"text-inside":!0},null,8,["percentage"]),a[3]||(a[3]=o("p",{class:"progress-text"},"任务正在执行中，请稍候...",-1))])):y("",!0)]),_:1}),e.value.status==="COMPLETED"&&v.value?(u(),T(L,{key:0},{header:s(()=>[...a[4]||(a[4]=[o("div",{class:"card-header"},[o("span",null,"性能指标")],-1)])]),default:s(()=>[t(B,{gutter:16},{default:s(()=>[e.value.algorithm.category==="KEM"?(u(),p(A,{key:0},[t(d,{xs:24,sm:12,lg:6},{default:s(()=>[o("div",Be,[a[5]||(a[5]=o("div",{class:"metric-title"},"密钥生成",-1)),o("div",Le,r(g(v.value.avg_keygen_time)),1)])]),_:1}),t(d,{xs:24,sm:12,lg:6},{default:s(()=>[o("div",Fe,[a[6]||(a[6]=o("div",{class:"metric-title"},"封装时间",-1)),o("div",Ae,r(g(v.value.avg_encaps_time)),1)])]),_:1}),t(d,{xs:24,sm:12,lg:6},{default:s(()=>[o("div",Ge,[a[7]||(a[7]=o("div",{class:"metric-title"},"解封装时间",-1)),o("div",Oe,r(g(v.value.avg_decaps_time)),1)])]),_:1})],64)):(u(),p(A,{key:1},[t(d,{xs:24,sm:12,lg:6},{default:s(()=>[o("div",Ve,[a[8]||(a[8]=o("div",{class:"metric-title"},"密钥生成",-1)),o("div",$e,r(g(v.value.avg_keygen_time)),1)])]),_:1}),t(d,{xs:24,sm:12,lg:6},{default:s(()=>[o("div",Ue,[a[9]||(a[9]=o("div",{class:"metric-title"},"签名时间",-1)),o("div",Ye,r(g(v.value.avg_sign_time)),1)])]),_:1}),t(d,{xs:24,sm:12,lg:6},{default:s(()=>[o("div",He,[a[10]||(a[10]=o("div",{class:"metric-title"},"验证时间",-1)),o("div",Ke,r(g(v.value.avg_verify_time)),1)])]),_:1})],64)),t(d,{xs:24,sm:12,lg:6},{default:s(()=>[o("div",je,[a[11]||(a[11]=o("div",{class:"metric-title"},"成功率",-1)),o("div",ze,r($(v.value.success_rate)),1)])]),_:1})]),_:1})]),_:1})):y("",!0),o("div",qe,[e.value.status==="RUNNING"?(u(),T(m,{key:0,type:"warning",onClick:z},{default:s(()=>[t(i,null,{default:s(()=>[t(k(Ne))]),_:1}),a[12]||(a[12]=n(" 停止任务 ",-1))]),_:1})):y("",!0),e.value.status==="COMPLETED"?(u(),T(m,{key:1,type:"success",onClick:q},{default:s(()=>[t(i,null,{default:s(()=>[t(k(De))]),_:1}),a[13]||(a[13]=n(" 生成PDF报告 ",-1))]),_:1})):y("",!0),e.value.status==="COMPLETED"?(u(),T(m,{key:2,type:"info",onClick:J},{default:s(()=>[t(i,null,{default:s(()=>[t(k(Me))]),_:1}),a[14]||(a[14]=n(" 导出CSV数据 ",-1))]),_:1})):y("",!0),t(m,{type:"danger",onClick:W,disabled:e.value.status==="RUNNING"},{default:s(()=>[t(i,null,{default:s(()=>[t(k(xe))]),_:1}),a[15]||(a[15]=n(" 删除任务 ",-1))]),_:1},8,["disabled"])])])):x.value?(u(),p("div",Je,[t(i,{class:"is-loading",size:"32"},{default:s(()=>[t(k(we))]),_:1}),a[16]||(a[16]=o("p",null,"加载任务详情中...",-1))])):(u(),T(ee,{key:2,description:"任务不存在或加载失败"}))])}}});const ot=se(We,[["__scopeId","data-v-7e3c9764"]]);export{ot as default};
//# sourceMappingURL=TaskDetail-e372dc1f.js.map
