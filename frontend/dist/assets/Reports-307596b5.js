import{b as O,_ as W}from"./index-b2730f11.js";/* empty css                   *//* empty css                         */import{V as i,_ as X,W as Z,X as Q,a8 as ee,O as _,Y as te,a9 as B,P as ae,Z as se,ax as le,ay as oe,az as ne,$ as de,a0 as re,a1 as ie,a2 as ce,ak as _e,a5 as F,aI as ue,aJ as $,aC as fe,aG as pe,aK as me,ao as ve,aL as we}from"./element-plus-53375c2c.js";import{l as ye,r as C,c as h,b as ge,j as he,q as D,t as l,H as e,B as t,m as f,u as d,F as r,C as be,A as b,E as ke}from"./vendor-05288756.js";const xe={class:"reports-container"},Ce={class:"page-header"},De={class:"header-actions"},Ee={class:"stats-item"},Re={class:"stats-content"},Be={class:"stats-number"},Fe={class:"stats-item"},$e={class:"stats-content"},Pe={class:"stats-number"},Ve={class:"stats-item"},Te={class:"stats-content"},Se={class:"stats-number"},Me={class:"card-header"},Ae={class:"header-actions"},Ne={class:"report-name"},Ue={class:"pdf-preview"},Ye=["src"],ze={key:1,class:"preview-loading"},Ie=ye({__name:"Reports",setup(He){const c=O(),p=C([]),v=C(!1),w=C(""),y=h(()=>c.reports),P=h(()=>y.value.length),V=h(()=>y.value.filter(s=>s.file_type==="PDF").length),T=h(()=>y.value.filter(s=>s.file_type==="CSV").length),S=s=>te(s).format("YYYY-MM-DD HH:mm"),M=s=>s?s<1024?`${s} B`:s<1024*1024?`${(s/1024).toFixed(1)} KB`:`${(s/(1024*1024)).toFixed(1)} MB`:"N/A",A=async()=>{try{await c.fetchAllReports(),i.success("数据刷新成功")}catch{i.error("数据刷新失败")}},N=s=>{p.value=s},U=async s=>{if(p.value.length===0){i.warning("请先选择要操作的报告");return}if(s==="download")for(const a of p.value)E(a);else if(s==="delete")try{await B.confirm(`确定要删除选中的 ${p.value.length} 个报告吗？此操作不可恢复。`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});for(const a of p.value)await c.deleteReport(a.id);i.success("批量删除成功"),p.value=[]}catch(a){a!=="cancel"&&i.error("批量删除失败")}},E=s=>{const a=c.getDownloadUrl(s.id),n=document.createElement("a");n.href=a,n.download=s.report_name,n.target="_blank",document.body.appendChild(n),n.click(),document.body.removeChild(n),i.success("开始下载报告")},Y=s=>{if(s.file_type!=="PDF"){i.warning("只能预览PDF格式的报告");return}w.value=c.getPreviewUrl(s.id),v.value=!0};ge(v,s=>{s||(w.value="")});const z=async s=>{try{await B.confirm(`确定要删除报告 "${s.report_name}" 吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await c.deleteReport(s.id),i.success("删除成功")}catch(a){a!=="cancel"&&i.error("删除失败")}},I=s=>{window.open(`/tasks/${s}`,"_blank")};return he(()=>{c.fetchAllReports()}),(s,a)=>{const n=ae,m=X,g=Z,k=se,H=Q,R=le,j=oe,K=ne,u=de,L=re,q=ie,G=ee,J=ce;return f(),D("div",xe,[l("div",Ce,[a[2]||(a[2]=l("h2",null,"报告中心",-1)),l("div",De,[e(m,{onClick:A},{default:t(()=>[e(n,null,{default:t(()=>[e(d(_e))]),_:1}),a[1]||(a[1]=r(" 刷新 ",-1))]),_:1})])]),e(H,{gutter:16,class:"stats-row"},{default:t(()=>[e(k,{xs:24,sm:8},{default:t(()=>[e(g,{class:"stats-card"},{default:t(()=>[l("div",Ee,[e(n,{class:"stats-icon",color:"#409eff"},{default:t(()=>[e(d(F))]),_:1}),l("div",Re,[l("div",Be,_(P.value),1),a[3]||(a[3]=l("div",{class:"stats-label"},"总报告数",-1))])])]),_:1})]),_:1}),e(k,{xs:24,sm:8},{default:t(()=>[e(g,{class:"stats-card"},{default:t(()=>[l("div",Fe,[e(n,{class:"stats-icon",color:"#67c23a"},{default:t(()=>[e(d(ue))]),_:1}),l("div",$e,[l("div",Pe,_(V.value),1),a[4]||(a[4]=l("div",{class:"stats-label"},"PDF 报告",-1))])])]),_:1})]),_:1}),e(k,{xs:24,sm:8},{default:t(()=>[e(g,{class:"stats-card"},{default:t(()=>[l("div",Ve,[e(n,{class:"stats-icon",color:"#e6a23c"},{default:t(()=>[e(d($))]),_:1}),l("div",Te,[l("div",Se,_(T.value),1),a[5]||(a[5]=l("div",{class:"stats-label"},"CSV 报告",-1))])])]),_:1})]),_:1})]),_:1}),e(g,null,{header:t(()=>[l("div",Me,[a[9]||(a[9]=l("span",null,"报告列表",-1)),l("div",Ae,[e(K,{onCommand:U},{dropdown:t(()=>[e(j,null,{default:t(()=>[e(R,{command:"download"},{default:t(()=>[...a[7]||(a[7]=[r("批量下载",-1)])]),_:1}),e(R,{command:"delete",divided:""},{default:t(()=>[...a[8]||(a[8]=[r("批量删除",-1)])]),_:1})]),_:1})]),default:t(()=>[e(m,{type:"primary"},{default:t(()=>[a[6]||(a[6]=r(" 批量操作 ",-1)),e(n,null,{default:t(()=>[e(d(fe))]),_:1})]),_:1})]),_:1})])])]),default:t(()=>[be((f(),b(q,{data:y.value,"empty-text":"暂无报告数据",onSelectionChange:N},{default:t(()=>[e(u,{type:"selection",width:"55"}),e(u,{prop:"report_name",label:"报告名称","min-width":"200"},{default:t(({row:o})=>[l("div",Ne,[e(n,null,{default:t(()=>[o.file_type==="PDF"?(f(),b(d(F),{key:0})):(f(),b(d($),{key:1}))]),_:2},1024),l("span",null,_(o.report_name),1)])]),_:1}),e(u,{prop:"file_type",label:"文件类型",width:"100"},{default:t(({row:o})=>[e(L,{type:o.file_type==="PDF"?"success":"warning",size:"small"},{default:t(()=>[r(_(o.file_type),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"file_size",label:"文件大小",width:"120"},{default:t(({row:o})=>[r(_(M(o.file_size)),1)]),_:1}),e(u,{label:"关联任务",width:"150"},{default:t(({row:o})=>[e(m,{text:"",type:"primary",size:"small",onClick:x=>I(o.task_id)},{default:t(()=>[r(" 任务 #"+_(o.task_id),1)]),_:2},1032,["onClick"])]),_:1}),e(u,{prop:"created_at",label:"生成时间",width:"160",sortable:""},{default:t(({row:o})=>[r(_(S(o.created_at)),1)]),_:1}),e(u,{label:"操作",width:"180",fixed:"right"},{default:t(({row:o})=>[e(m,{text:"",type:"primary",size:"small",onClick:x=>E(o)},{default:t(()=>[e(n,null,{default:t(()=>[e(d(pe))]),_:1}),a[10]||(a[10]=r(" 下载 ",-1))]),_:1},8,["onClick"]),o.file_type==="PDF"?(f(),b(m,{key:0,text:"",type:"success",size:"small",onClick:x=>Y(o)},{default:t(()=>[e(n,null,{default:t(()=>[e(d(me))]),_:1}),a[11]||(a[11]=r(" 预览 ",-1))]),_:1},8,["onClick"])):ke("",!0),e(m,{text:"",type:"danger",size:"small",onClick:x=>z(o)},{default:t(()=>[e(n,null,{default:t(()=>[e(d(ve))]),_:1}),a[12]||(a[12]=r(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[J,d(c).loading]])]),_:1}),e(G,{modelValue:v.value,"onUpdate:modelValue":a[0]||(a[0]=o=>v.value=o),title:"报告预览",width:"80%"},{default:t(()=>[l("div",Ue,[w.value?(f(),D("iframe",{key:0,src:w.value,width:"100%",height:"600px",frameborder:"0"},null,8,Ye)):(f(),D("div",ze,[e(n,{class:"is-loading"},{default:t(()=>[e(d(we))]),_:1}),a[13]||(a[13]=l("span",null,"加载中...",-1))]))])]),_:1},8,["modelValue"])])}}});const Je=W(Ie,[["__scopeId","data-v-4857af3b"]]);export{Je as default};
//# sourceMappingURL=Reports-307596b5.js.map
