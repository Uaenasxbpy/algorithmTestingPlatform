import{u as ie,_ as ne}from"./index-b2730f11.js";/* empty css                   *//* empty css                 *//* empty css                  */import{V as i,_ as ue,W as de,a8 as me,O as K,Y as pe,a9 as ce,P as _e,aa as fe,ab as ge,ac as ve,ad as ye,$ as be,a0 as Ee,ae as Ce,a1 as xe,af as Ae,ag as Se,ah as Ve,ai as we,a2 as Ne,aj as he,ak as Ke,U as Me,al as ke,am as U,an as Le,ao as Qe,ap as qe}from"./element-plus-53375c2c.js";import{l as Pe,r as A,h as M,c as Ue,j as Ie,q as N,t,H as l,B as s,m as x,u as f,F as n,C as Re,A as I,E as Oe,G as k}from"./vendor-05288756.js";const Te={class:"algorithms-container"},$e={class:"page-header"},De={class:"header-actions"},Be={class:"algorithm-name"},Fe={class:"form-help-text"},He={class:"dialog-footer"},Ge=Pe({__name:"Algorithms",setup(ze){const c=ie(),b=A(!1),g=A(null),S=A(!1),h=A(!1),E=A(),m=M({category:"",source:"",is_active:""}),v=M({prop:"",order:""}),r=M({name:"",category:"KEM",source:"liboqs",version:"",description:"",library_name:""}),R={name:[{required:!0,message:"请输入算法名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"},{pattern:/^[a-zA-Z0-9_+-]+$/,message:"算法名称只能包含字母、数字、下划线、加号和减号",trigger:"blur"}],category:[{required:!0,message:"请选择算法类别",trigger:"change"}],source:[{required:!0,message:"请选择算法来源",trigger:"change"}],library_name:[{required:!0,message:"请输入库函数名",trigger:"blur"},{min:3,max:100,message:"库函数名长度在 3 到 100 个字符",trigger:"blur"},{validator:(a,e,u)=>{r.source==="liboqs"&&!e.startsWith("OQS_")?u(new Error("liboqs 算法的库函数名应以 OQS_ 开头")):r.source==="pqclean"&&!e.startsWith("PQCLEAN_")?u(new Error("PQClean 算法的库函数名应以 PQCLEAN_ 开头")):u()},trigger:"blur"}],version:[{required:!0,message:"请输入版本号",trigger:"blur"},{pattern:/^\d+\.\d+(\.\d+)?$/,message:"版本号格式应为 x.y 或 x.y.z",trigger:"blur"}]},O=Ue(()=>{let a=[...c.algorithms];return m.category&&(a=a.filter(e=>e.category===m.category)),m.source&&(a=a.filter(e=>e.source===m.source)),m.is_active!==""&&(a=a.filter(e=>e.is_active===m.is_active)),v.prop&&v.order&&a.sort((e,u)=>{let p=e[v.prop],d=u[v.prop];return v.prop==="created_at"&&(p=new Date(p).getTime(),d=new Date(d).getTime()),v.order==="ascending"?p>d?1:-1:p<d?1:-1}),a}),T=a=>pe(a).format("YYYY-MM-DD HH:mm"),$=async()=>{try{await c.fetchAlgorithms(),i.success("数据刷新成功")}catch{i.error("数据刷新失败")}},D=()=>{},B=()=>{m.category="",m.source="",m.is_active=""},F=({prop:a,order:e})=>{v.prop=a,v.order=e},H=async a=>{a.updating=!0;try{await c.updateAlgorithm(a.id,{is_active:a.is_active}),i.success("状态更新成功")}catch{a.is_active=!a.is_active,i.error("状态更新失败")}finally{a.updating=!1}},G=async a=>{try{const e=await c.testAlgorithm(a.id);e.success?i.success("算法测试成功"):i.warning(`算法测试失败: ${e.message||"未知错误"}`)}catch(e){i.error(`算法测试出错: ${e.message||"网络错误"}`)}},z=async a=>{try{i.info("正在验证算法配置...");const e=await L(a);e.valid?i.success("算法配置验证成功"):i.warning(`算法配置验证失败: ${e.message}`)}catch(e){i.error(`验证配置出错: ${e.message||"网络错误"}`)}},Y=async()=>{if(E.value)try{if(!await E.value.validate()){i.warning("请先填写完所有必填项");return}h.value=!0,i.info("正在验证算法配置...");const e=await L(r);e.valid?i.success("算法配置验证成功，可以安全添加"):i.warning(`算法配置验证失败: ${e.message}`)}catch(a){i.error(`验证配置出错: ${a.message||"网络错误"}`)}finally{h.value=!1}},j=a=>{g.value=a,Object.assign(r,{name:a.name,category:a.category,source:a.source,version:a.version||"",description:a.description||"",library_name:a.library_name||""}),b.value=!0},W=async a=>{try{await ce.confirm(`确定要删除算法 "${a.name}" 吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await c.deleteAlgorithm(a.id),i.success("删除成功")}catch(e){e!=="cancel"&&i.error("删除失败")}},J=async()=>{if(E.value)try{if(!await E.value.validate())return;if(S.value=!0,!g.value&&c.algorithms.find(u=>u.name.toLowerCase()===r.name.toLowerCase())){i.error("算法名称已存在，请使用不同的名称"),S.value=!1;return}g.value?(await c.updateAlgorithm(g.value.id,r),i.success("更新成功")):(await c.createAlgorithm(r),i.success("添加成功")),b.value=!1}catch{i.error(g.value?"更新失败":"添加失败")}finally{S.value=!1}},Z=()=>{var a;g.value=null,Object.assign(r,{name:"",category:"KEM",source:"liboqs",version:"",description:"",library_name:""}),(a=E.value)==null||a.resetFields()},X=()=>r.source==="liboqs"?"请输入库函数名（如：OQS_KEM_kyber_512）":r.source==="pqclean"?"请输入库函数名（如：PQCLEAN_KYBER512_CLEAN）":"请输入C库中的函数名前缀",L=async a=>{try{return await(await fetch("/api/v1/algorithms/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a.name,category:a.category,source:a.source,library_name:a.library_name,version:a.version})})).json()}catch(e){return console.error("验证算法配置失败:",e),{valid:!1,message:"验证服务不可用"}}};return Ie(()=>{c.fetchAlgorithms()}),(a,e)=>{const u=_e,p=ue,d=fe,V=ge,_=ve,Q=ye,q=de,y=be,ee=Ee,le=Ce,ae=xe,w=Ae,P=Se,te=Ve,se=we,oe=me,re=Ne;return x(),N("div",Te,[t("div",$e,[e[14]||(e[14]=t("h2",null,"算法管理",-1)),t("div",De,[l(p,{type:"primary",onClick:e[0]||(e[0]=o=>b.value=!0)},{default:s(()=>[l(u,null,{default:s(()=>[l(f(he))]),_:1}),e[12]||(e[12]=n(" 添加算法 ",-1))]),_:1}),l(p,{onClick:$},{default:s(()=>[l(u,null,{default:s(()=>[l(f(Ke))]),_:1}),e[13]||(e[13]=n(" 刷新 ",-1))]),_:1})])]),l(q,{class:"filter-card","body-style":{padding:"16px"}},{default:s(()=>[l(Q,{model:m,inline:""},{default:s(()=>[l(_,{label:"算法类别"},{default:s(()=>[l(V,{modelValue:m.category,"onUpdate:modelValue":e[1]||(e[1]=o=>m.category=o),placeholder:"全部类别",clearable:""},{default:s(()=>[l(d,{label:"全部",value:""}),l(d,{label:"KEM",value:"KEM"}),l(d,{label:"签名",value:"SIGNATURE"})]),_:1},8,["modelValue"])]),_:1}),l(_,{label:"算法来源"},{default:s(()=>[l(V,{modelValue:m.source,"onUpdate:modelValue":e[2]||(e[2]=o=>m.source=o),placeholder:"全部来源",clearable:""},{default:s(()=>[l(d,{label:"全部",value:""}),l(d,{label:"liboqs",value:"liboqs"}),l(d,{label:"PQClean",value:"pqclean"})]),_:1},8,["modelValue"])]),_:1}),l(_,{label:"状态"},{default:s(()=>[l(V,{modelValue:m.is_active,"onUpdate:modelValue":e[3]||(e[3]=o=>m.is_active=o),placeholder:"全部状态",clearable:""},{default:s(()=>[l(d,{label:"全部",value:""}),l(d,{label:"激活",value:!0}),l(d,{label:"禁用",value:!1})]),_:1},8,["modelValue"])]),_:1}),l(_,null,{default:s(()=>[l(p,{type:"primary",onClick:D},{default:s(()=>[...e[15]||(e[15]=[n("查询",-1)])]),_:1}),l(p,{onClick:B},{default:s(()=>[...e[16]||(e[16]=[n("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(q,null,{default:s(()=>[Re((x(),I(ae,{data:O.value,"empty-text":"暂无算法数据",onSortChange:F},{default:s(()=>[l(y,{prop:"name",label:"算法名称","min-width":"150",sortable:"custom"},{default:s(({row:o})=>[t("div",Be,[l(u,null,{default:s(()=>[l(f(Me))]),_:1}),t("span",null,K(o.name),1)])]),_:1}),l(y,{prop:"category",label:"类别",width:"100"},{default:s(({row:o})=>[l(ee,{type:o.category==="KEM"?"primary":"success",size:"small"},{default:s(()=>[n(K(o.category==="KEM"?"KEM":"签名"),1)]),_:2},1032,["type"])]),_:1}),l(y,{prop:"source",label:"来源",width:"100"}),l(y,{prop:"version",label:"版本",width:"100"}),l(y,{prop:"description",label:"描述","min-width":"200","show-overflow-tooltip":""}),l(y,{prop:"is_active",label:"状态",width:"80"},{default:s(({row:o})=>[l(le,{modelValue:o.is_active,"onUpdate:modelValue":C=>o.is_active=C,onChange:C=>H(o),loading:o.updating},null,8,["modelValue","onUpdate:modelValue","onChange","loading"])]),_:1}),l(y,{prop:"created_at",label:"创建时间",width:"160",sortable:"custom"},{default:s(({row:o})=>[n(K(T(o.created_at)),1)]),_:1}),l(y,{label:"操作",width:"250",fixed:"right"},{default:s(({row:o})=>[l(p,{text:"",type:"primary",size:"small",onClick:C=>G(o)},{default:s(()=>[l(u,null,{default:s(()=>[l(f(ke))]),_:1}),e[17]||(e[17]=n(" 测试 ",-1))]),_:1},8,["onClick"]),l(p,{text:"",type:"primary",size:"small",onClick:C=>z(o)},{default:s(()=>[l(u,null,{default:s(()=>[l(f(U))]),_:1}),e[18]||(e[18]=n(" 验证配置 ",-1))]),_:1},8,["onClick"]),l(p,{text:"",type:"primary",size:"small",onClick:C=>j(o)},{default:s(()=>[l(u,null,{default:s(()=>[l(f(Le))]),_:1}),e[19]||(e[19]=n(" 编辑 ",-1))]),_:1},8,["onClick"]),l(p,{text:"",type:"danger",size:"small",onClick:C=>W(o)},{default:s(()=>[l(u,null,{default:s(()=>[l(f(Qe))]),_:1}),e[20]||(e[20]=n(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[re,f(c).loading]])]),_:1}),l(oe,{modelValue:b.value,"onUpdate:modelValue":e[11]||(e[11]=o=>b.value=o),title:g.value?"编辑算法":"添加算法",width:"600px",onClosed:Z},{footer:s(()=>[t("div",He,[l(p,{onClick:e[10]||(e[10]=o=>b.value=!1)},{default:s(()=>[...e[32]||(e[32]=[n("取消",-1)])]),_:1}),g.value?Oe("",!0):(x(),I(p,{key:0,type:"info",onClick:Y,loading:h.value},{default:s(()=>[l(u,null,{default:s(()=>[l(f(U))]),_:1}),e[33]||(e[33]=n(" 验证配置 ",-1))]),_:1},8,["loading"])),l(p,{type:"primary",onClick:J,loading:S.value},{default:s(()=>[l(u,null,{default:s(()=>[l(f(qe))]),_:1}),e[34]||(e[34]=n(" 确定 ",-1))]),_:1},8,["loading"])])]),default:s(()=>[l(Q,{ref_key:"algorithmFormRef",ref:E,model:r,rules:R,"label-width":"100px"},{default:s(()=>[l(_,{label:"算法名称",prop:"name"},{default:s(()=>[l(w,{modelValue:r.name,"onUpdate:modelValue":e[4]||(e[4]=o=>r.name=o),placeholder:"请输入算法名称（如：Kyber512、Dilithium2）"},null,8,["modelValue"]),e[21]||(e[21]=t("div",{class:"form-help-text"},[t("div",{class:"help-title"},"常见后量子密码算法名称示例："),t("div",{class:"algorithm-examples"},[t("div",{class:"example-title"},"KEM算法："),t("div",{class:"example-item"},"• Kyber512, Kyber768, Kyber1024"),t("div",{class:"example-item"},"• NTRU-HPS-2048-509, NTRU-HPS-2048-677"),t("div",{class:"example-item"},"• SABER-KEM-128s, SABER-KEM-192f, SABER-KEM-256f"),t("div",{class:"example-title"},"签名算法："),t("div",{class:"example-item"},"• Dilithium2, Dilithium3, Dilithium5"),t("div",{class:"example-item"},"• Falcon-512, Falcon-1024"),t("div",{class:"example-item"},"• SPHINCS+-SHAKE256-128s, SPHINCS+-SHA256-192f")])],-1))]),_:1}),l(_,{label:"算法类别",prop:"category"},{default:s(()=>[l(te,{modelValue:r.category,"onUpdate:modelValue":e[5]||(e[5]=o=>r.category=o)},{default:s(()=>[l(P,{label:"KEM"},{default:s(()=>[...e[22]||(e[22]=[n("KEM (密钥封装)",-1)])]),_:1}),l(P,{label:"SIGNATURE"},{default:s(()=>[...e[23]||(e[23]=[n("SIGNATURE (数字签名)",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(_,{label:"算法来源",prop:"source"},{default:s(()=>[l(V,{modelValue:r.source,"onUpdate:modelValue":e[6]||(e[6]=o=>r.source=o),placeholder:"请选择算法来源"},{default:s(()=>[l(d,{label:"liboqs",value:"liboqs"}),l(d,{label:"PQClean",value:"pqclean"}),l(d,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),l(_,{label:"版本号",prop:"version"},{default:s(()=>[l(w,{modelValue:r.version,"onUpdate:modelValue":e[7]||(e[7]=o=>r.version=o),placeholder:"请输入版本号（如：1.0、1.2.3）"},null,8,["modelValue"]),e[24]||(e[24]=t("div",{class:"form-help-text"}," 版本号格式：x.y 或 x.y.z（如：1.0、1.2.3） ",-1))]),_:1}),l(_,{label:"库函数名",prop:"library_name"},{default:s(()=>[l(w,{modelValue:r.library_name,"onUpdate:modelValue":e[8]||(e[8]=o=>r.library_name=o),placeholder:X()},null,8,["modelValue","placeholder"]),t("div",Fe,[r.source==="liboqs"?(x(),N(k,{key:0},[e[25]||(e[25]=t("div",{class:"help-title"},"liboqs 库函数名命名规范：",-1)),e[26]||(e[26]=t("div",{class:"algorithm-examples"},[t("div",{class:"example-title"},"KEM算法："),t("div",{class:"example-item"},"• OQS_KEM_kyber_512、OQS_KEM_kyber_768"),t("div",{class:"example-item"},"• OQS_KEM_ntru_hps2048509、OQS_KEM_ntru_hps2048677"),t("div",{class:"example-title"},"签名算法："),t("div",{class:"example-item"},"• OQS_SIG_dilithium_2、OQS_SIG_dilithium_3"),t("div",{class:"example-item"},"• OQS_SIG_falcon_512、OQS_SIG_falcon_1024")],-1))],64)):r.source==="pqclean"?(x(),N(k,{key:1},[e[27]||(e[27]=t("div",{class:"help-title"},"PQClean 库函数名命名规范：",-1)),e[28]||(e[28]=t("div",{class:"algorithm-examples"},[t("div",{class:"example-title"},"KEM算法："),t("div",{class:"example-item"},"• PQCLEAN_KYBER512_CLEAN、PQCLEAN_KYBER768_CLEAN"),t("div",{class:"example-item"},"• PQCLEAN_NTRUHPS2048509_CLEAN"),t("div",{class:"example-title"},"签名算法："),t("div",{class:"example-item"},"• PQCLEAN_DILITHIUM2_CLEAN、PQCLEAN_DILITHIUM3_CLEAN"),t("div",{class:"example-item"},"• PQCLEAN_FALCON512_CLEAN、PQCLEAN_FALCON1024_CLEAN")],-1))],64)):(x(),N(k,{key:2},[e[29]||(e[29]=t("div",{class:"help-title"},"请输入C库中的函数名前缀",-1)),e[30]||(e[30]=t("div",{class:"form-help-text"},"确保函数名与实际的C库函数名称一致",-1))],64))])]),_:1}),l(_,{label:"算法描述",prop:"description"},{default:s(()=>[l(w,{modelValue:r.description,"onUpdate:modelValue":e[9]||(e[9]=o=>r.description=o),type:"textarea",rows:3,placeholder:"请输入算法描述"},null,8,["modelValue"])]),_:1}),l(se,{title:"算法测试指导",type:"info",closable:!1,style:{"margin-top":"16px"}},{default:s(()=>[...e[31]||(e[31]=[t("div",{class:"test-guide"},[t("p",null,[t("strong",null,"为确保算法能正常通过后端测试，请注意以下要点：")]),t("ul",null,[t("li",null,[t("strong",null,"算法名称："),n("必须与实际算法标准名称一致")]),t("li",null,[t("strong",null,"库函数名："),n("必须与实际C库中的函数名称完全匹配")]),t("li",null,[t("strong",null,"算法类别："),n("选择正确的类别（KEM或SIGNATURE）")]),t("li",null,[t("strong",null,"算法来源："),n("选择正确的来源库（liboqs、pqclean或其他）")])]),t("p",null,[t("strong",null,"建议："),n("在添加算法前，请先点击“验证配置”按钮检查配置是否正确。")])],-1)])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});const el=ne(Ge,[["__scopeId","data-v-5ce561f8"]]);export{el as default};
//# sourceMappingURL=Algorithms-d90ca04b.js.map
