import{u as Te,a as be,_ as we}from"./index-b2730f11.js";/* empty css                    *//* empty css                         *//* empty css                   *//* empty css                  */import{l as xe,r as T,h as Ne,c as C,j as Ce,J as De,q as g,t as r,H as t,B as a,m as d,u as y,F as o,L as Ie,G as R,W as q,E as D,C as Me,A as b}from"./vendor-05288756.js";import{V as c,_ as Ve,X as Ae,O as u,Y as K,a9 as S,P as Se,aq as Be,ab as Pe,ac as Fe,af as Ge,ar as Ue,as as $e,at as ze,ad as Le,au as Oe,av as Re,a0 as qe,aw as Ke,W as He,Z as Ye,ax as je,ay as Je,az as We,$ as Xe,aA as Ze,a1 as Qe,a2 as et,ak as tt,a3 as H,aB as at,aC as st,aa as lt}from"./element-plus-53375c2c.js";const ot={class:"testing-container"},nt={class:"page-header"},rt={class:"header-actions"},it={class:"card-header"},ut={style:{float:"right",color:"#8492a6","font-size":"13px"}},dt={style:{float:"right",color:"#8492a6","font-size":"13px"}},ct={key:0,class:"algorithm-info"},mt={class:"card-header"},_t={class:"header-actions"},pt={class:"el-dropdown-link"},ft={key:0,class:"progress-info"},gt={class:"progress-text"},vt={key:1,class:"status-text success"},yt={key:2,class:"status-text error"},ht=xe({__name:"Testing",setup(Et){const w=Te(),m=be(),x=T(),I=T(!1),B=T([]),h=T(""),M=T("");let N=null;const n=Ne({algorithm_id:null,test_name:"",test_count:100,parameters:{}}),Y={algorithm_id:[{required:!0,message:"请选择算法",trigger:"change"}],test_name:[{required:!0,message:"请输入测试名称",trigger:"blur"},{min:2,max:100,message:"长度在 2 到 100 个字符",trigger:"blur"}],test_count:[{required:!0,message:"请输入测试次数",trigger:"blur"},{type:"number",min:1,max:1e4,message:"测试次数在 1 到 10000 之间",trigger:"blur"}]},j=C(()=>w.activeAlgorithms.filter(l=>l.category==="KEM")),J=C(()=>w.activeAlgorithms.filter(l=>l.category==="SIGNATURE")),_=C(()=>w.getAlgorithmById(n.algorithm_id)),W=C(()=>{let l=[...m.tasks];return M.value&&(l=l.filter(e=>e.status===M.value)),l.sort((e,i)=>new Date(i.created_at).getTime()-new Date(e.created_at).getTime())}),X=l=>K(l).format("MM-DD HH:mm"),Z=l=>({PENDING:"info",RUNNING:"warning",COMPLETED:"success",FAILED:"danger"})[l]||"info",Q=l=>({PENDING:"待运行",RUNNING:"运行中",COMPLETED:"已完成",FAILED:"失败"})[l]||l,P=l=>{const e=m.getTaskStatus(l);return(e==null?void 0:e.progress)||0},ee=()=>{_.value&&(n.test_name=`${_.value.name}_性能测试_${K().format("YYYY-MM-DD_HH-mm")}`)},F=async()=>{if(x.value)try{if(!await x.value.validate())return;I.value=!0;let e={};if(h.value.trim())try{e=JSON.parse(h.value)}catch{c.error("自定义参数格式错误，请使用有效的JSON格式");return}const i={...n,parameters:e};await m.executeTest(i),c.success("测试任务创建成功，正在后台执行"),te()}catch{c.error("创建测试任务失败")}finally{I.value=!1}},te=()=>{var l;n.algorithm_id=null,n.test_name="",n.test_count=100,n.parameters={},h.value="",(l=x.value)==null||l.resetFields()},ae=l=>{M.value=l},se=l=>{m.setCurrentTask(l),window.open(`/tasks/${l.id}`,"_blank")},le=async l=>{try{await S.confirm(`确定要停止任务 "${l.task_name}" 吗？`,"确认停止",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await m.stopTask(l.id),c.success("任务已停止")}catch(e){e!=="cancel"&&c.error("停止任务失败")}},oe=async l=>{try{await S.confirm(`确定要运行任务 "${l.task_name}" 吗？`,"确认运行",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"});const e=await fetch(`http://localhost:8000/api/v1/tasks/${l.id}/run`,{method:"POST",headers:{"Content-Type":"application/json"}});if(e.ok)c.success("任务已开始运行"),await m.fetchTasks({limit:50});else{const i=await e.json();c.error(i.detail||"运行任务失败")}}catch(e){e!=="cancel"&&c.error("运行任务失败")}},ne=async l=>{try{await S.confirm(`确定要删除任务 "${l.task_name}" 吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await m.deleteTask(l.id),c.success("删除成功")}catch(e){e!=="cancel"&&c.error("删除失败")}},G=async()=>{try{await Promise.all([w.fetchAlgorithms(),m.fetchTasks({limit:50})]),c.success("数据刷新成功")}catch{c.error("数据刷新失败")}},re=()=>{N=setInterval(async()=>{const l=m.runningTasks;if(l.length>0)for(const e of l)try{await m.fetchTaskStatus(e.id)}catch(i){console.error("获取任务状态失败:",i)}},3e3)},ie=()=>{N&&(clearInterval(N),N=null)};return Ce(async()=>{await G(),re()}),De(()=>{ie()}),(l,e)=>{const i=Se,p=Ve,U=lt,$=Be,ue=Pe,v=Fe,z=Ge,de=Ue,ce=$e,me=ze,_e=Le,pe=Oe,E=Re,V=qe,fe=Ke,L=He,O=Ye,k=je,ge=Je,ve=We,f=Xe,ye=Ze,he=Qe,Ee=Ae,ke=et;return d(),g("div",ot,[r("div",nt,[e[6]||(e[6]=r("h2",null,"性能测试",-1)),r("div",rt,[t(p,{onClick:G},{default:a(()=>[t(i,null,{default:a(()=>[t(y(tt))]),_:1}),e[5]||(e[5]=o(" 刷新 ",-1))]),_:1})])]),t(Ee,{gutter:24},{default:a(()=>[t(O,{xs:24,lg:10},{default:a(()=>[t(L,null,{header:a(()=>[r("div",it,[t(i,null,{default:a(()=>[t(y(H))]),_:1}),e[7]||(e[7]=r("span",null,"创建新测试",-1))])]),default:a(()=>[t(_e,{ref_key:"testFormRef",ref:x,model:n,rules:Y,"label-width":"100px",onSubmit:Ie(F,["prevent"])},{default:a(()=>[t(v,{label:"选择算法",prop:"algorithm_id"},{default:a(()=>[t(ue,{modelValue:n.algorithm_id,"onUpdate:modelValue":e[0]||(e[0]=s=>n.algorithm_id=s),placeholder:"请选择要测试的算法",onChange:ee,style:{width:"100%"}},{default:a(()=>[t($,{label:"KEM算法"},{default:a(()=>[(d(!0),g(R,null,q(j.value,s=>(d(),b(U,{key:s.id,label:s.name,value:s.id},{default:a(()=>[r("span",null,u(s.name),1),r("span",ut,u(s.source),1)]),_:2},1032,["label","value"]))),128))]),_:1}),t($,{label:"签名算法"},{default:a(()=>[(d(!0),g(R,null,q(J.value,s=>(d(),b(U,{key:s.id,label:s.name,value:s.id},{default:a(()=>[r("span",null,u(s.name),1),r("span",dt,u(s.source),1)]),_:2},1032,["label","value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(v,{label:"测试名称",prop:"test_name"},{default:a(()=>[t(z,{modelValue:n.test_name,"onUpdate:modelValue":e[1]||(e[1]=s=>n.test_name=s),placeholder:"请输入测试名称"},null,8,["modelValue"])]),_:1}),t(v,{label:"测试次数",prop:"test_count"},{default:a(()=>[t(de,{modelValue:n.test_count,"onUpdate:modelValue":e[2]||(e[2]=s=>n.test_count=s),min:1,max:1e4,step:10,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(v,null,{default:a(()=>[t(me,{modelValue:B.value,"onUpdate:modelValue":e[4]||(e[4]=s=>B.value=s)},{default:a(()=>[t(ce,{title:"高级参数",name:"advanced"},{default:a(()=>[t(v,{label:"自定义参数"},{default:a(()=>[t(z,{modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=s=>h.value=s),type:"textarea",rows:3,placeholder:'JSON格式的自定义参数，如：{"threads": 4}'},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(v,null,{default:a(()=>[t(p,{type:"primary",onClick:F,loading:I.value,style:{width:"100%"},size:"large"},{default:a(()=>[t(i,null,{default:a(()=>[t(y(H))]),_:1}),e[8]||(e[8]=o(" 开始测试 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),_.value?(d(),g("div",ct,[t(pe,null,{default:a(()=>[...e[9]||(e[9]=[o("算法信息",-1)])]),_:1}),t(fe,{column:1,border:"",size:"small"},{default:a(()=>[t(E,{label:"算法名称"},{default:a(()=>[o(u(_.value.name),1)]),_:1}),t(E,{label:"算法类别"},{default:a(()=>[t(V,{type:_.value.category==="KEM"?"primary":"success"},{default:a(()=>[o(u(_.value.category==="KEM"?"KEM":"签名算法"),1)]),_:1},8,["type"])]),_:1}),t(E,{label:"算法来源"},{default:a(()=>[o(u(_.value.source),1)]),_:1}),t(E,{label:"算法版本"},{default:a(()=>[o(u(_.value.version||"N/A"),1)]),_:1}),t(E,{label:"算法描述"},{default:a(()=>[o(u(_.value.description||"暂无描述"),1)]),_:1})]),_:1})])):D("",!0)]),_:1})]),_:1}),t(O,{xs:24,lg:14},{default:a(()=>[t(L,null,{header:a(()=>[r("div",mt,[t(i,null,{default:a(()=>[t(y(at))]),_:1}),e[16]||(e[16]=r("span",null,"测试任务",-1)),r("div",_t,[t(ve,{onCommand:ae},{dropdown:a(()=>[t(ge,null,{default:a(()=>[t(k,{command:""},{default:a(()=>[...e[11]||(e[11]=[o("全部状态",-1)])]),_:1}),t(k,{command:"PENDING"},{default:a(()=>[...e[12]||(e[12]=[o("待运行",-1)])]),_:1}),t(k,{command:"RUNNING"},{default:a(()=>[...e[13]||(e[13]=[o("运行中",-1)])]),_:1}),t(k,{command:"COMPLETED"},{default:a(()=>[...e[14]||(e[14]=[o("已完成",-1)])]),_:1}),t(k,{command:"FAILED"},{default:a(()=>[...e[15]||(e[15]=[o("失败",-1)])]),_:1})]),_:1})]),default:a(()=>[r("span",pt,[e[10]||(e[10]=o(" 状态筛选 ",-1)),t(i,null,{default:a(()=>[t(y(st))]),_:1})])]),_:1})])])]),default:a(()=>[Me((d(),b(he,{data:W.value,"empty-text":"暂无测试任务","max-height":"600"},{default:a(()=>[t(f,{prop:"task_name",label:"任务名称","min-width":"150"}),t(f,{prop:"algorithm.name",label:"算法",width:"120"},{default:a(({row:s})=>[t(V,{type:s.algorithm.category==="KEM"?"primary":"success",size:"small"},{default:a(()=>[o(u(s.algorithm.name),1)]),_:2},1032,["type"])]),_:1}),t(f,{prop:"test_count",label:"测试次数",width:"80"}),t(f,{prop:"status",label:"状态",width:"100"},{default:a(({row:s})=>[t(V,{type:Z(s.status),size:"small"},{default:a(()=>[o(u(Q(s.status)),1)]),_:2},1032,["type"])]),_:1}),t(f,{label:"进度",width:"120"},{default:a(({row:s})=>[s.status==="RUNNING"?(d(),g("div",ft,[t(ye,{percentage:P(s.id),"stroke-width":6,"show-text":!1},null,8,["percentage"]),r("span",gt,u(P(s.id))+"%",1)])):s.status==="COMPLETED"?(d(),g("span",vt," ✓ 完成 ")):s.status==="FAILED"?(d(),g("span",yt," ✗ 失败 ")):D("",!0)]),_:1}),t(f,{prop:"created_at",label:"创建时间",width:"140"},{default:a(({row:s})=>[o(u(X(s.created_at)),1)]),_:1}),t(f,{label:"操作",width:"200",fixed:"right"},{default:a(({row:s})=>[t(p,{text:"",type:"primary",size:"small",onClick:A=>se(s)},{default:a(()=>[...e[17]||(e[17]=[o(" 查看 ",-1)])]),_:1},8,["onClick"]),s.status==="PENDING"?(d(),b(p,{key:0,text:"",type:"success",size:"small",onClick:A=>oe(s)},{default:a(()=>[...e[18]||(e[18]=[o(" 运行 ",-1)])]),_:1},8,["onClick"])):D("",!0),s.status==="RUNNING"?(d(),b(p,{key:1,text:"",type:"warning",size:"small",onClick:A=>le(s)},{default:a(()=>[...e[19]||(e[19]=[o(" 停止 ",-1)])]),_:1},8,["onClick"])):D("",!0),t(p,{text:"",type:"danger",size:"small",onClick:A=>ne(s),disabled:s.status==="RUNNING"},{default:a(()=>[...e[20]||(e[20]=[o(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[ke,y(m).loading]])]),_:1})]),_:1})]),_:1})])}}});const Dt=we(ht,[["__scopeId","data-v-ddc2477a"]]);export{Dt as default};
//# sourceMappingURL=Testing-287f5f69.js.map
